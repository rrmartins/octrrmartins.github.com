<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: RealTime | Rodrigo Martins]]></title>
  <link href="http://rrmartins.github.com/blog/categories/realtime/atom.xml" rel="self"/>
  <link href="http://rrmartins.github.com/"/>
  <updated>2012-05-15T13:23:16-03:00</updated>
  <id>http://rrmartins.github.com/</id>
  <author>
    <name><![CDATA[Rodrigo Martins]]></name>
    <email><![CDATA[rodrigo@rrmartins.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Desenvolvendo Um Chat com NodeJS]]></title>
    <link href="http://rrmartins.github.com/blog/2012/04/30/desenvolvendo-um-chat-com-nodejs/"/>
    <updated>2012-04-30T17:34:00-03:00</updated>
    <id>http://rrmartins.github.com/blog/2012/04/30/desenvolvendo-um-chat-com-nodejs</id>
    <content type="html"><![CDATA[<p>Olá Developers...</p>

<p>Vamos desenvolver um pequeno Chat em NodeJS... Estou começando com os estudos de NodeJS tambem, e tem sido de grande valia para mim...</p>

<p>Então, antes de mais nada, vamos fazer o download do NodeJS no link <a href="http://nodejs.org/#download">nodejs.org</a>, ou podemos instalar com o <a href="https://github.com/joyent/node/wiki/Installing-Node.js-via-package-manager">Node Package Manager (npm)</a>. Eu estou usando o npm, e indico a todos... :D</p>

<p>Vamos criar a aplicação, crie uma pasta com o nome da aplicação:</p>

<p>{% codeblock Criando Pasta %}
mkdir app_chat
{% endcodeblock %}</p>

<p>Agora vamos entrar na pasta do projeto, e criar o arquivo que será nosso servidor, nome exemplo: heloword_server.js.</p>

<p>Hora de começar a brincar com o servidor.</p>

<p>``` javascript Criando o server
var fs = require('fs');
var server = require('http').createServer(function(req, response){
  fs.readFile('helloworld.html', function(err, data){</p>

<pre><code>response.writeHead(200, {'Content-Type':'text/html'});  
response.write(data);  
response.end();
</code></pre>

<p>  });
});
```</p>

<p>Na linha 1, temos um require('fs'), este é um framework do nodejs, que serve para trabalhar com arquivos.</p>

<p>Na linha 2, estamos instanciando e criando o server 'http'.</p>

<p>Na linha 3, já dentro da função do createServer, temos a leitura do arquivo que será alimentado, e uma criação de função.</p>

<p>Na linha 4, estamos escrevendo o arquivo, lembrando que ele será do tipo HTML.</p>

<p>Na linha 5, temos a escrita no arquivo. E abaixo finalizamos.</p>

<p>Este processo de leitura do arquivo, ocorre sempre que alguem entra na aplicação.</p>

<p>Vamos continuar, agora vamos colocar uma porta para o servidor.</p>

<p>``` javascript Criando uma porta e aplicando ao server
var port = process.env.PORT || 3000;</p>

<p>server.listen(port, function() {
  console.log("Listening on " + port);
});
```</p>

<p>Neste exemplo acima, pegamos o número da porta do processo, ou fica valendo a porta 3000.</p>

<p>Logo depois coloco a port no server, neste exemplo eu criei uma função, só para logar o numero da porta, logo nos logs do servidor estará o numero da porta, quando iniciar.</p>

<p>Vamos agora começar a escrever as funcionalidades do servidor. Vamos escrever as funções que tratam que esta entrando e quem esta saindo da app.</p>

<p>``` javascript Function Connected e Disconnected
var everyone = require("now").initialize(server);</p>

<p>everyone.connected(function(){
  console.log("Joined: " + this.now.name);
});</p>

<p>everyone.disconnected(function(){
  console.log("Left: " + this.now.name);
});
```</p>

<p>Nesta função, instancio o framework '<a href="http://www.nowjs.com/">now</a>', que voce pode esta instalando com o comando: npm install now</p>

<p>Dentro do '<a href="http://www.nowjs.com/">now</a>', temos 2 funções, a <a href="http://www.nowjs.com/doc/symbols/nowjs#event:connect">connected</a> e a <a href="http://www.nowjs.com/doc/symbols/nowjs#event:disconnect">disconnected</a>, nessas funções, estou registrando quem esta se logando e quem esta saindo da aplicação.</p>

<p>Agora vem a parte legal, vamos criar em modo de execução 2 funções, só que uma dentro da outra, ou seja, vamos usar fortemente o conceito de <a href="http://lucastex.com.br/2009/10/21/nao-tenha-medo-das-closures/">closure</a>, mas por favor, não tenha medo disso, parece estranho no inicio, mas acredite o trem é legal...</p>

<p>``` javascript Criando Funções dentro de Funções
everyone.now.distributeMessage = function(message){</p>

<pre><code>console.log("mensagem "+message);
message = message.replace(/(&lt;([^&gt;]+)&gt;)/ig,"");
everyone.now.receiveMessage(this.now.name, message);
</code></pre>

<p>};
```</p>

<p>Neste bloco de codigos, estamos criando a função distributeMessage, que esta, receberá a mensagem.</p>

<p>Na linha 2, estou somente logando a mensagem que chegou.</p>

<p>Na liinha 3, estamos tratando com uma expressão regular, a mensagem que chega, para que ninguem possa trollar a app com codigo de javascript, e outras coisas...</p>

<p>Na linha 4, estamos fazendo a chamada da função que esta na view, e ela que imprimi a mensagem no DOM.</p>

<p>Logo o arquivo do helloword_server.js precisa ficar assim:</p>

<p>{% include_code Arquivo do Server NodeJS helloworld_server.js %}</p>

<h3>Criando a View</h3>


<p>A nossa view, será basicamente HTML, e um pouco de simples javascript, então, dessa vez será 0 de explicação.</p>

<p>{% include_code View do Chat helloworld.html %}</p>

<p>Proximo, passo, só levantar o servidor:
{% codeblock Levantando o Servidor %}
node helloworld_server.js
{% endcodeblock %}</p>

<p>É isso ai amigos, segue o lick de como a aplicação ficou no heroku, e o lick do repositorio dela no github.</p>

<p>Heroku -> <a href="http://nodechat.herokuapp.com">nodechat.herokuapp.com</a></p>

<p>Github -> <a href="https://github.com/rrmartins/node_chat">Node Chat</a></p>

<p>Até a proxima..</p>
]]></content>
  </entry>
  
</feed>
